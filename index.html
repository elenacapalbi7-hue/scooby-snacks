<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Scooby Evolution</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Arial Black', sans-serif; touch-action: none; }
        #game-container { position: relative; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
        canvas { background: #111; max-width: 100%; max-height: 100%; object-fit: contain; border: 3px solid #ccff00; }
        #ui { position: absolute; top: 15px; width: 90%; display: flex; justify-content: space-between; color: #ccff00; font-size: 18px; z-index: 100; pointer-events: none; }
        #startBtn { position: absolute; padding: 20px 50px; font-size: 24px; background: #ccff00; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; z-index: 200; box-shadow: 0 0 15px #ccff00; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="ui">
            <div>MODO: <span id="modeName">INICIO</span></div>
            <div>GALLETAS: <span id="sc">0</span></div>
        </div>
        <button id="startBtn" onclick="startGame()">¡EMPEZAR!</button>
        <canvas id="canvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 800; canvas.height = 450;

        const imgS = new Image(); imgS.src = '4d0e8e93e8663b020f6063451e53118a.png';
        const imgG = new Image(); imgG.src = 'eb4380a3cf64873dc0ebbad595d0886f.png';
        const imgB = new Image(); imgB.src = '1766045750713.png';
        const imgF = new Image(); imgF.src = '535eb96ca41945fbcd1774e60989d8e3.png';
        const sndJ = new Audio('audio saltoo.mp4');
        const sndE = new Audio('audio galletaa.mp4');

        let score = 0, level = 1, speed = 5, active = false, frame = 0;
        let scooby = { x: 80, y: 335, w: 70, h: 70, dy: 0, jumps: 0, inverted: false };
        let obs = [], snacks = [], platforms = [], bgX = 0;

        function startGame() {
            active = true; score = 0; level = 1; speed = 5; obs = []; snacks = []; platforms = []; frame = 0;
            scooby.y = 335; scooby.dy = 0; scooby.jumps = 0;
            document.getElementById('sc').innerText = "0";
            document.getElementById('startBtn').classList.add('hidden');
            update();
        }

        function update() {
            if (!active) return;
            ctx.clearRect(0, 0, 800, 450);

            bgX -= (speed - 1);
            if(bgX <= -800) bgX = 0;
            ctx.drawImage(imgB, bgX, 0, 800, 450);
            ctx.drawImage(imgB, bgX + 800, 0, 800, 450);

            // --- CONFIGURACIÓN DE MODOS POR NIVEL ---
            let mode = "NORMAL";
            if (level >= 6) {
                mode = "JETPACK";
                scooby.dy += 0.25; 
            } else if (level === 5) {
                mode = "GRAVITY";
                scooby.dy += (scooby.inverted ? -0.8 : 0.8);
            } else if (level === 4) {
                mode = "FLAPPY";
                scooby.dy += 0.45;
            } else if (level === 3) {
                mode = "MARIO";
                scooby.dy += 0.8;
            } else {
                mode = "NORMAL";
                scooby.dy += 0.8;
            }
            document.getElementById('modeName').innerText = mode;

            scooby.y += scooby.dy;

            // Suelo y Techo
            if(scooby.y > 335) { scooby.y = 335; scooby.dy = 0; scooby.jumps = 0; }
            if(scooby.y < 0) { scooby.y = 0; scooby.dy = 0; }
            
            ctx.drawImage(imgS, scooby.x, scooby.y, scooby.w, scooby.h);

            // Escalones (Solo Nivel 3)
            if(level === 3 && frame % 150 === 0) platforms.push({x: 800, y: 230, w: 160, h: 25});
            for(let i=platforms.length-1; i>=0; i--){
                let p = platforms[i];
                p.x -= speed;
                ctx.fillStyle = "#8B4513"; ctx.fillRect(p.x, p.y, p.w, p.h);
                if(scooby.dy > 0 && scooby.x < p.x+p.w && scooby.x+scooby.w > p.x && scooby.y+scooby.h > p.y && scooby.y+scooby.h < p.y+25) {
                    scooby.y = p.y - scooby.h; scooby.dy = 0; scooby.jumps = 0;
                }
                if(p.x < -200) platforms.splice(i, 1);
            }

            // Fantasmas
            if(frame % Math.max(40, 140 - (level*10)) === 0) {
                let yPos = (level >= 4) ? Math.random() * 300 : 345;
                obs.push({x: 800, y: yPos, w: 55, h: 55});
            }
            for(let i=obs.length-1; i>=0; i--){
                let o = obs[i];
                o.x -= (speed + 2);
                ctx.drawImage(imgF, o.x, o.y, o.w, o.h);
                if(scooby.x+15 < o.x+o.w-15 && scooby.x+scooby.w-15 > o.x+15 && scooby.y+15 < o.y+o.h-15 && scooby.y+scooby.h-15 > o.y+15) {
                    active = false;
                    document.getElementById('startBtn').classList.remove('hidden');
                    document.getElementById('startBtn').innerText = "REINTENTAR";
                }
                if(o.x < -100) obs.splice(i, 1);
            }

            // Galletas
            if(frame % 110 === 0) snacks.push({x: 800, y: 120 + Math.random()*220, w: 45, h: 45});
            for(let i=snacks.length-1; i>=0; i--){
                let s = snacks[i];
                s.x -= speed;
                ctx.drawImage(imgG, s.x, s.y, s.w, s.h);
                if(scooby.x < s.x+s.w && scooby.x+scooby.w > s.x && scooby.y < s.y+s.h && scooby.y+scooby.h > s.y) {
                    snacks.splice(i, 1);
                    score++;
                    document.getElementById('sc').innerText = score;
                    sndE.play().catch(()=>{});
                    if(score % 10 === 0) { level++; speed += 1.3; }
                }
                if(s.x < -100) snacks.splice(i, 1);
            }

            frame++;
            requestAnimationFrame(update);
        }

        function handleInput(e) {
            if(!active) return;
            if(e) e.preventDefault();
            
            if (level <= 3) { // DOBLE SALTO (Normal y Mario)
                if(scooby.jumps < 2) {
                    scooby.dy = -16;
                    scooby.jumps++;
                    sndJ.play().catch(()=>{});
                }
            } else if(level === 4) { // Flappy
                scooby.dy = -8;
                sndJ.play().catch(()=>{});
            } else if(level === 5) { // Gravity
                scooby.inverted = !scooby.inverted;
                sndJ.play().catch(()=>{});
            } else if(level >= 6) { // Jetpack
                scooby.dy -= 2.2;
                sndJ.play().catch(()=>{});
            }
        }

        window.addEventListener('touchstart', handleInput, {passive: false});
        window.addEventListener('mousedown', handleInput);
    </script>
</body>
</html>
