<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SCOBY: Level-Up Cookies</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; touch-action: none; -webkit-user-select: none; }
        #game-container { position: relative; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
        canvas { background: #111; max-width: 100%; max-height: 100%; border: 3px solid #ccff00; }
        * { font-family: 'Press Start 2P', cursive; }
        .title-scoby { font-size: 45px; margin: 0; line-height: 1.2; background: linear-gradient(to bottom, #00BFFF 50%, #FFD700 50%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(4px 4px 0px #000); }
        .title-level { font-size: 18px; margin: 10px 0 25px 0; background: linear-gradient(to bottom, #FFFFFF 50%, #32CD32 50%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(2px 2px 0px #000); }
        .phrase-container { position: relative; max-width: 85%; margin-bottom: 30px; }
        .scooby-mini { position: absolute; top: -45px; right: -10px; width: 60px; transform: rotate(10deg); }
        .instrucciones { color: #fff; font-size: 10px; line-height: 1.8; text-shadow: 2px 2px #000; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; border: 2px solid #555; }
        #ui { position: absolute; top: 10px; width: 92%; display: flex; justify-content: space-between; color: #ccff00; font-size: 10px; z-index: 100; pointer-events: none; text-shadow: 2px 2px #000; }
        .menu { position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 200; color: white; text-align: center; padding: 20px; box-sizing: border-box; }
        .btn-main { padding: 15px 30px; font-size: 16px; background: #ccff00; border: none; border-radius: 5px; cursor: pointer; color: black; box-shadow: 0 6px 0 #88aa00; margin-top: 10px; }
        .btn-main:active { transform: translateY(4px); box-shadow: none; }
        .high-score-label { color: #FFD700; margin-top: 15px; font-size: 12px; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="ui">
            <div>NIVEL: <span id="lvDisp">1</span></div>
            <div>üç™: <span id="sc">0</span></div>
            <div>TOP: <span id="hi">0</span></div>
        </div>

        <div id="mainMenu" class="menu">
            <h1 class="title-scoby">SCOBY</h1>
            <h2 class="title-level">LEVEL-UP COOKIES</h2>
            <div class="phrase-container">
                <img src="4d0e8e93e8663b020f6063451e53118a.png" class="scooby-mini">
                <p class="instrucciones">
                    "¬°Scooby-Dooby-Doo! Sigue saltando, esquiva los fantasmas y recolecta esas mini cookies ‚Äî l√°rgate de un nivel a otro cada vez que comas 10 mini cookies. ¬°Ruh-roh si te atrapa un fantasma antes!"
                </p>
            </div>
            <button class="btn-main" onpointerdown="startGame(event)">¬°JUGAR!</button>
            <div class="high-score-label">R√âCORD: <span id="mainHi">0</span></div>
        </div>

        <div id="deathMenu" class="menu" style="display:none;">
            <h1 style="color:red; font-size: 25px;">¬°GAME OVER!</h1>
            <p style="font-size: 12px; margin: 20px 0 10px 0;">PUNTUACI√ìN</p>
            <h2 id="finalScore" style="font-size: 40px; color:#ccff00;">0</h2>
            <p id="newRecordMsg" style="color:#FFD700; font-size: 10px; display:none;">¬°NUEVO R√âCORD!</p>
            <button class="btn-main" onpointerdown="startGame(event)">REINTENTAR</button>
        </div>

        <canvas id="c"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');
        canvas.width = 800; canvas.height = 450;

        const imgS = new Image(); imgS.src = '4d0e8e93e8663b020f6063451e53118a.png';
        const imgG = new Image(); imgG.src = 'eb4380a3cf64873dc0ebbad595d0886f.png';
        const imgB = new Image(); imgB.src = '1766045750713.png';
        const imgF = new Image(); imgF.src = '535eb96ca41945fbcd1774e60989d8e3.png';
        
        const sndJ = new Audio('audio saltoo.mp4');
        const sndE = new Audio('audio galletaa.mp4');
        const bgM = new Audio('DanLebowitzTiptoeOuttheBack.mp4');
        bgM.loop = true;

        let score = 0, level = 1, speed = 7, active = false, frame = 0, gravity = 0.95;
        let scooby = { x: 80, y: 330, w: 75, h: 75, dy: 0, jumps: 0 };
        let obs = [], snacks = [], bgX = 0;

        let highScore = localStorage.getItem('scobyHighScore') || 0;
        document.getElementById('hi').innerText = highScore;
        document.getElementById('mainHi').innerText = highScore;

        function startGame(e) {
            if(e) e.stopPropagation();
            active = true; score = 0; level = 1; speed = 7; obs = []; snacks = []; frame = 0;
            scooby = { x: 80, y: 330, w: 75, h: 75, dy: 0, jumps: 0 };
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('deathMenu').style.display = 'none';
            document.getElementById('newRecordMsg').style.display = 'none';
            document.getElementById('sc').innerText = "0";
            document.getElementById('lvDisp').innerText = "1";
            bgM.currentTime = 0; bgM.play().catch(()=>{});
            requestAnimationFrame(animate);
        }

        function handleInput() {
            if(!active) return;
            sndJ.currentTime = 0; sndJ.play().catch(()=>{});
            
            // L√≥gica c√≠clica de mec√°nicas (1 al 25)
            let mechanic = ((level - 1) % 25) + 1;

            if (mechanic === 17) { scooby.dy = 12; } 
            else if (mechanic === 21) { scooby.x += 100; if(scooby.x > 500) scooby.x = 80; scooby.dy = -15; }
            else if (mechanic === 5 || mechanic === 2 || mechanic === 4) { scooby.dy = -11; }
            else if (mechanic === 7) { scooby.dy = -21; } 
            else { if(scooby.jumps < 2) { scooby.dy = -17; scooby.jumps++; } }
        }

        window.onpointerdown = (e) => { if(active && e.target.tagName !== 'BUTTON') { e.preventDefault(); handleInput(); } };

        function animate() {
            if (!active) return;
            ctx.clearRect(0,0,800,450);
            
            let mechanic = ((level - 1) % 25) + 1;
            document.getElementById('lvDisp').innerText = level;

            // Selecci√≥n de Gravedad seg√∫n la mec√°nica del ciclo
            if (mechanic === 5 || mechanic === 2) { gravity = 0.4; }
            else if (mechanic === 7) { gravity = 2.1; } 
            else if (mechanic === 17) { gravity = -0.95; }
            else { gravity = 0.95; }

            // Velocidad especial en mec√°nica 23
            let currentSpeed = (mechanic === 23) ? speed * 0.5 : speed;
            
            scooby.dy += gravity;
            scooby.y += scooby.dy;

            let groundLimit = 450 - scooby.h - 40;
            if(mechanic !== 17 && scooby.y > groundLimit) { scooby.y = groundLimit; scooby.dy = 0; scooby.jumps = 0; }
            if(mechanic === 17 && scooby.y < 20) { scooby.y = 20; scooby.dy = 0; scooby.jumps = 0; }

            bgX -= (currentSpeed/2); if(bgX <= -800) bgX = 0;
            ctx.drawImage(imgB, bgX, 0, 800, 450); ctx.drawImage(imgB, bgX+800, 0, 800, 450);
            ctx.drawImage(imgS, scooby.x, scooby.y, scooby.w, scooby.h);

            // OBST√ÅCULOS SEG√öN MEC√ÅNICA
            if(frame % 85 === 0) {
                if (mechanic === 5) {
                    obs.push({x: 800, y: 0, w: 100, h: 150});
                    obs.push({x: 800, y: 300, w: 100, h: 150});
                } else {
                    let hF = (mechanic === 7) ? 40 : 60;
                    let wF = (mechanic === 7) ? 50 : 60;
                    let yF = (mechanic === 17) ? 20 : (mechanic === 7 ? 370 : 335);
                    obs.push({x: 800, y: yF, w: wF, h: hF});
                }
            }

            for(let i=obs.length-1; i>=0; i--) {
                obs[i].x -= (currentSpeed + 2.5);
                ctx.drawImage(imgF, obs[i].x, obs[i].y, obs[i].w, obs[i].h);
                if(scooby.x+20 < obs[i].x+obs[i].w-20 && scooby.x+scooby.w-20 > obs[i].x+20 && scooby.y+20 < obs[i].y+obs[i].h-15 && scooby.y+scooby.h-15 > obs[i].y+15) endGame();
                if(obs[i].x < -150) obs.splice(i, 1);
            }

            // SNACKS Y SUBIDA DE NIVEL
            if(frame % 70 === 0) snacks.push({x: 800, y: 150 + Math.random()*150, w: 45, h: 45});
            for(let i=snacks.length-1; i>=0; i--){
                snacks[i].x -= currentSpeed;
                ctx.drawImage(imgG, snacks[i].x, snacks[i].y, snacks[i].w, snacks[i].h);
                if(scooby.x < snacks[i].x+40 && scooby.x+scooby.w > snacks[i].x && scooby.y < snacks[i].y+40 && scooby.y+scooby.h > snacks[i].y) {
                    score++; snacks.splice(i,1); sndE.play().catch(()=>{});
                    document.getElementById('sc').innerText = score;
                    
                    if(score % 10 === 0) { 
                        level++; 
                        // L√ìGICA DE VELOCIDAD MEJORADA
                        speed += 0.15; // Aumento normal por nivel
                        
                        // Si estamos en la segunda tanda (Nivel > 25) y cada 5 niveles
                        if(level > 25 && level % 5 === 0) {
                            speed += 0.40; // Turbo extra de velocidad por dificultad avanzada
                        }
                    }
                }
                if(snacks[i] && snacks[i].x < -100) snacks.splice(i,1);
            }

            frame++;
            if(active) requestAnimationFrame(animate);
        }

        function endGame() {
            active = false; bgM.pause();
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('scobyHighScore', highScore);
                document.getElementById('hi').innerText = highScore;
                document.getElementById('mainHi').innerText = highScore;
                document.getElementById('newRecordMsg').style.display = 'block';
            }
            document.getElementById('finalScore').innerText = score;
            document.getElementById('deathMenu').style.display = 'flex';
        }
    </script>
</body>
</html>
