<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Scooby Snacks Runner</title>

<!-- Firebase (Required for Global Leaderboard) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- PWA Manifest -->
<link rel="manifest" href="data:application/json,{
  &quot;name&quot;:&quot;Scooby Snacks Runner&quot;,
  &quot;short_name&quot;:&quot;ScoobyRun&quot;,
  &quot;start_url&quot;:&quot;.&quot;,
  &quot;display&quot;:&quot;standalone&quot;,
  &quot;background_color&quot;:&quot;#000000&quot;,
  &quot;theme_color&quot;:&quot;#4b0082&quot;
}">
<meta name="theme-color" content="#4b0082">

<style>
body, html { margin:0; padding:0; overflow:hidden; background:#000; }
canvas { display:block; margin:auto; background:#000; }

#controls { position:absolute; bottom:20px; width:100%; display:flex; justify-content:center; }
button { width:120px; height:120px; font-size:24px; border-radius:50%; border:none; background:rgba(255,255,255,0.2); color:#fff; }

#hud { position:absolute; top:10px; left:10px; color:#fff; font-size:18px; }

#leaderboard { position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.6); padding:10px; border-radius:8px; width:200px; color:#fff; font-size:14px; }
</style>
</head>

<body>

<div id="hud">Score: <span id="score">0</span></div>
<div id="leaderboard"><strong>Global Leaderboard</strong><ol id="scores"></ol></div>

<canvas id="game" width="360" height="640"></canvas>

<div id="controls">
  <button id="jumpBtn">JUMP</button>
  <button id="musicBtn">MUSIC</button>
</div>

<script>
/* ============================
   FIREBASE SETUP (Global LB)
============================ */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ============================
   CANVAS SETUP
============================ */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let score = 0;
let speed = 4;
let gravity = 0.6;
let gameOver = false;
let lastScoreTime = Date.now();

/* ============================
   IMAGES
============================ */
const bgImage = new Image();
bgImage.src = "https://cdn.pixabay.com/photo/2022/10/15/14/10/haunted-house-7510053_1280.png";

const scoobyImg = new Image();
scoobyImg.src = "https://www.pngkey.com/png/full/76-760499_download-zip-archive-scooby-doo-sprite-png.png";

const ghostImg = new Image();
ghostImg.src = "https://pngimg.com/uploads/ghost/ghost_PNG46.png";

const cookieImg = new Image();
cookieImg.src = "https://pngimg.com/uploads/cookie/cookie_PNG13656.png";

/* ============================
   SCOOBY PLAYER OBJECT
============================ */
const scooby = {
  x:50, y:520, vy:0, width:50, height:50,
  jump() { if (this.y >= 520) this.vy = -12; },
  update() { this.vy+=gravity; this.y+=this.vy; if(this.y>520){this.y=520;this.vy=0;} },
  draw() { ctx.drawImage(scoobyImg, this.x, this.y, this.width, this.height); }
};

let snacks = [], ghosts = [];

/* ============================
   LEADERBOARD GLOBAL
============================ */
function saveScoreGlobal(sc){
  const newRef = db.ref("scores").push();
  newRef.set({score:sc, time:Date.now()});
}

function fetchLeaderboard(){
  db.ref("scores").orderByChild("score").limitToLast(5).on("value", snapshot => {
    const list = document.getElementById("scores");
    list.innerHTML = "";
    snapshot.forEach(child => {
      const item = child.val();
      const li = document.createElement("li");
      li.textContent = item.score;
      list.prepend(li);
    });
  });
}
fetchLeaderboard();

/* ============================
   INPUT
============================ */
document.getElementById("jumpBtn").addEventListener("touchstart", e=>{ e.preventDefault(); scooby.jump(); });
document.addEventListener("keydown", e => { if(e.code==="Space") scooby.jump(); });

/* MUSIC & SOUND */
let musicOn = false;
const music = new Audio("https://cdn.pixabay.com/download/audio/2022/08/22/audio_4cf40fcb21.mp3?filename=spooky-atmosphere-110058.mp3");
music.loop = true;
const crunch = new Audio("https://cdn.pixabay.com/download/audio/2021/09/23/audio_0d460e65fe.mp3?filename=crunch-13588.mp3");

document.getElementById("musicBtn").addEventListener("click",()=>{
  musicOn = !musicOn;
  if(musicOn) music.play(); else music.pause();
});

/* ============================
   GAME LOOP
============================ */
function spawnSnack(){ snacks.push({x:canvas.width,y:520,size:30}); }
function spawnGhost(){ ghosts.push({x:canvas.width,y:520,size:40}); }

function update(){
  if(gameOver) return;
  scooby.update();
  snacks.forEach(s=>s.x-=speed);
  ghosts.forEach(g=>g.x-=speed);

  snacks = snacks.filter(s=>{
    if(s.x<scooby.x+scooby.width && s.x+s.size>scooby.x && s.y<scooby.y+scooby.height){
      if(Date.now()-lastScoreTime>100){ score++; lastScoreTime=Date.now(); crunch.play(); }
      return false;
    }
    return s.x>-s.size;
  });

  ghosts.forEach(g=>{
    if(g.x<scooby.x+scooby.width && g.x+g.size>scooby.x){
      gameOver=true;
      saveScoreGlobal(score);
      alert("Game Over! "+score);
      location.reload();
    }
  });

  if(Math.random()<0.02) spawnSnack();
  if(Math.random()<0.015) spawnGhost();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(bgImage,0,0,canvas.width,canvas.height);
  scooby.draw();
  snacks.forEach(s=>ctx.drawImage(cookieImg,s.x,s.y,s.size,s.size));
  ghosts.forEach(g=>ctx.drawImage(ghostImg,g.x,g.y,g.size,g.size));
  document.getElementById("score").innerText = score;
}

function loop(){ update(); draw(); requestAnimationFrame(loop); }
loop();

/* Service Worker */
if('serviceWorker' in navigator){
  const swCode = `
    self.addEventListener('install', e=>self.skipWaiting());
    self.addEventListener('fetch', e=>{ e.respondWith(fetch(e.request).catch(()=>new Response('Offline')); });
  `;
  const blob = new Blob([swCode],{type:'text/javascript'});
  navigator.serviceWorker.register(URL.createObjectURL(blob));
}
</script>

</body>
</html>
